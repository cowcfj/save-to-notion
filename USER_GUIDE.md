# 📖 Notion Smart Clipper 使用指南

本指南涵蓋擴展的所有功能、使用技巧和常見問題解決方案。

---

## 📑 目錄

- [🚀 快速開始](#-快速開始)
- [📖 基礎操作](#-基礎操作)
- [🎨 高級功能](#-高級功能)
- [💡 使用技巧](#-使用技巧)
- [❓ 常見問題 FAQ](#-常見問題-faq)
- [🔧 故障排除](#-故障排除)
- [📝 最佳實踐](#-最佳實踐)

---

## 🚀 快速開始

### 第一步：安裝擴展

1. 訪問 [Chrome Web Store - Save to Notion Smart Clipper](https://chromewebstore.google.com/detail/save-to-notion-smart-clip/gmelegphcncnddlaeogfhododhbcbmhp) 🔗
2. 點擊「**加到 Chrome**」按鈕
3. 在彈出的對話框中點擊「**新增擴充功能**」
4. ✅ 安裝完成!瀏覽器工具欄會顯示 Notion 圖標

### 第二步：連接 Notion

1. **創建 Notion Integration**
   - 訪問 [Notion Integrations](https://www.notion.so/my-integrations)
   - 點擊「+ New integration」
   - 填寫名稱(如 "Chrome Clipper")，選擇工作區
   - 複製生成的 **Internal Integration Token**

2. **配置擴展**
   - 點擊擴展圖標 → 點擊 `⚙️ Settings`
   - 貼上 API Token
   - 點擊「**連接到 Notion**」
   - 從下拉列表選擇目標資料來源（Notion 介面顯示為 Database 或 Data Source）
   - 點擊「**保存設置**」

   > ℹ️ **提示**：Notion 有時將資料庫稱為「Data Source」，擴展會自動處理這些名稱差異，您只需選擇目標資料庫即可。

3. **授權資料來源訪問**
   - 在 Notion 中打開目標資料庫（Database）
   - 點擊右上角「`...`」→「**Add connections**」
   - 選擇你剛創建的 Integration

🎉 配置完成！現在可以開始保存網頁了。

---

## 🔍 如何獲取 Notion ID

如果下拉選單和搜尋功能找不到您想要的頁面或數據庫，可以手動輸入 Notion ID。以下是獲取方法：

### 📄 獲取 Page ID（頁面 ID）

**方法一：從網頁 URL 獲取**

1. **打開目標頁面**：在瀏覽器中打開您想要保存內容的 Notion 頁面
2. **查看 URL**：URL 格式通常如下：
   ```
   https://www.notion.so/Your-Page-Name-1234567890abcdef1234567890abcdef
   ```
3. **提取 Page ID**：URL 最後的 32 個字符就是 Page ID
   - 示例：`1234567890abcdef1234567890abcdef`
   - 提示：ID 可能包含連字符（`-`），系統會自動處理

**方法二：從分享連結獲取**

1. **點擊分享**：在 Notion 頁面右上角點擊「Share」按鈕
2. **複製連結**：點擊「Copy link」
3. **從連結提取**：分享連結中最後的 32 字符即為 Page ID

**Page ID 格式**：
- ✅ 正確格式：`1234567890abcdef1234567890abcdef`（32 字符）
- ✅ 帶連字符：`12345678-90ab-cdef-1234-567890abcdef`（36 字符，系統自動處理）
- ❌ 錯誤格式：包含 `?v=` 等 URL 參數（請只複製 ID 部分）

### 📊 獲取 Database ID（數據庫 ID）

**方法一：從數據庫頁面 URL 獲取**

1. **打開數據庫**：在 Notion 中打開目標數據庫
2. **點擊「Open as page」**（如果是內嵌視圖）：
   - 如果數據庫顯示為頁面內的視圖，點擊視圖名稱
   - 選擇「Open source database」以全頁面模式打開
3. **查看 URL**：URL 格式通常如下：
   ```
   https://www.notion.so/1234567890abcdef1234567890abcdef?v=9876543210fedcba9876543210fedcba
   ```
4. **提取 Database ID**：`?v=` 之前的 32 字符就是 Database ID
   - 示例：`1234567890abcdef1234567890abcdef`

**方法二：從分享連結獲取**

1. **打開數據庫頁面**：確保以全頁面模式打開（非內嵌視圖）
2. **點擊右上角「Share」**
3. **複製連結**：點擊「Copy link」
4. **從連結提取**：`/` 和 `?` 之間的字符串即為 Database ID

**Database ID 格式**：
- ✅ 正確格式：`1234567890abcdef1234567890abcdef`（32 字符）
- ✅ 帶連字符：`12345678-90ab-cdef-1234-567890abcdef`（36 字符）
- ❌ 錯誤格式：包含 `?v=` 參數（請只複製 ID 部分）

### 🛠️ 使用手動輸入的 ID

1. **打開設定頁面**：點擊擴展圖標 → `⚙️ Settings`
2. **找到「Notion Data Source ID」欄位**
3. **貼上 ID**：將從上述方法獲取的 Page ID 或 Database ID 貼入
   - 系統會自動清理 URL 參數和連字符
   - 支援直接貼上完整 URL（系統自動提取 ID）
4. **保存設定**：點擊「Save Settings」
5. ✅ 完成！現在可以使用該頁面/數據庫作為保存目標

**提示**：
- 💡 如果貼上完整 URL，系統會自動提取 ID
- 💡 ID 格式錯誤時會顯示友好的錯誤提示
- 💡 建議優先使用下拉選單和搜尋功能，手動輸入作為備選方案

---

## 📖 基礎操作

### 1️⃣ 保存網頁

**操作步驟：**
1. 瀏覽到想要保存的網頁
2. 點擊擴展圖標
3. 點擊「**💾 Save Page**」按鈕
4. 等待保存完成（通常 2-5 秒）

**保存成功的標誌：**
- ✅ 擴展圖標右上角顯示**綠色 "✓" 徽章**
- ✅ 彈出窗口顯示「**🔗 Open in Notion**」按鈕
- ✅ 頁面內容和標註已同步到 Notion

### 2️⃣ 查看保存狀態

**圖標徽章系統：**
- **有綠色 "✓"** = 頁面已保存到 Notion
- **無徽章** = 頁面未保存

**徽章自動更新：**
- 切換到已保存的頁面時自動顯示
- 保存成功後立即顯示
- 在 Notion 中刪除頁面後自動清除

### 3️⃣ 快速打開 Notion 頁面

**方法一：彈出窗口按鈕**
1. 點擊擴展圖標
2. 點擊「**🔗 Open in Notion**」

**方法二：標註工具欄按鈕**
1. 開啟標註模式
2. 在標註工具欄或列表頭部點擊「**🔗 打開**」按鈕

### 4️⃣ 文本標註

**啟用標註模式：**
1. 點擊擴展圖標
2. 點擊「**🎨 Start Highlighting**」
3. 選擇標註顏色（黃、綠、藍、紅、紫）

**創建與同步：**
1. 在頁面上選中文字，標註自動創建
2. 點擊「**同步**」按鈕將標註保存到 Notion

**刪除標註：**
- 雙擊標註文本，或按住 `Ctrl`/`Cmd` + 點擊標註進行刪除

---

## 🎨 高級功能

### 🎯 自定義標題模板

**可配置標題格式，支持變量：**
- `{title}` - 網頁標題
- `{date}` - 保存日期（YYYY-MM-DD）
- `{domain}` - 網站域名
- `{url}` - 完整 URL

**配置位置：** Settings → 頁面模板設置

---

**示例模板：**
```
[{domain}] {title}
→ 結果：[example.com] 文章標題

{date} - {title}
→ 結果：2025-10-05 - 文章標題

📌 {title} | {domain}
→ 結果：📌 文章標題 | example.com
```

### 📄 內容自定義選項

**在設置中可配置：**
- ☑️ **添加保存時間戳**（顯示在內容頂部）
- ☑️ **添加來源信息**（包含原始 URL 和域名）
- ☑️ **使用自定義模板**（標題格式化）

---

## ❓ 常見問題 FAQ

### 🔌 連接和配置問題

**Q1: 無法連接到 Notion？**

**A:** 檢查以下項目：
1. ✅ API Token 是否正確複製（無多餘空格）
2. ✅ Integration 是否已創建並激活
3. ✅ 網絡連接是否正常
4. ✅ 在設置頁點擊「測試連接」診斷問題

**解決步驟：**
```
1. 重新生成 API Token
2. 清除設置並重新輸入
3. 檢查瀏覽器控制台錯誤（F12）
```

**Q2: 看不到我的資料來源（Database）？**

**A:** 確保：
1. Integration 已添加到資料來源連接（Database Connection）
2. 資料來源類型正確（需要支持頁面創建）
3. 重新載入擴展後重試

**授權步驟：**
```
Notion 資料來源（Database） → 右上角 ... 
→ Add connections 
→ 選擇你的 Integration
```

### 💾 保存問題

**Q3: 保存失敗，顯示錯誤？**

**A:** 常見原因：
- **網絡問題**：檢查網絡連接，重試
- **API 限制**：Notion API 有速率限制（3 請求/秒），稍後重試
- **內容過長**：v2.7.3+ 已修復，確保使用最新版本
- **權限問題**：確認 Integration 有寫入權限

**調試步驟：**
```
1. F12 打開控制台
2. 切換到 Console 標籤
3. 查看錯誤信息（以 ❌ 開頭）
4. 記錄錯誤並反饋
```

**Q4: 保存的內容不完整？**

**A:** 可能原因：
- **動態加載內容**：某些網站內容需要滾動才加載，保存前先滾動到底部
- **受保護內容**：付費牆或登錄保護的內容無法提取
- **特殊頁面結構**：某些 SPA 應用可能不完全兼容

**建議：**
- 等待頁面完全加載後再保存
- 使用 Readability 友好的網站
- 檢查 Notion 頁面確認實際內容

**Q5: "Open in Notion" 按鈕不顯示？**

**A:** 檢查：
1. 頁面是否已保存（圖標有綠色 ✓）
2. 等待 2-3 秒（按鈕異步加載）
3. 關閉並重新打開彈出窗口

### 🎨 標註問題

**Q6: 標註無法創建？**

**A:** 確認：
1. 是否已點擊「Start Highlighting」
2. 是否選擇了標註顏色
3. 選中的文字是否在頁面主要內容中
4. 瀏覽器是否支持 CSS Highlight API（Chrome 105+）

**Q7: 標註不同步到 Notion？**

**A:** 檢查：
1. 是否點擊了「**同步**」按鈕
2. 頁面是否已保存（必須先保存頁面）
3. 網絡連接是否正常
4. 查看控制台是否有錯誤

### 🗑️ 數據管理

**Q8: 如何刪除已保存的頁面？**

**A:** 在 Notion 中直接刪除即可：
1. 打開 Notion 資料來源（Database）
2. 找到對應頁面
3. 刪除頁面
4. 擴展會自動清除本地記錄（徽章會消失）

**Q9: 擴展存儲了哪些數據？**

**A:** 本地存儲的數據：
- `saved_{url}`: 頁面保存狀態和 Notion URL
- `highlights_{url}`: 標註數據（Range 位置信息）
- API Token 和設置（加密存儲）

**Q10: 如何清理無效數據？**

**A:** v2.7.2+ 版本已自動清理：
- 刪除 Notion 頁面時自動清理本地數據
- 減少 90%+ 無效數據累積
- 無需手動操作

**數據管理功能（v2.8.1 改進）：**
```
1. 設置頁面 → 數據管理
2. 檢查數據完整性 - 檢測並統計遷移數據
3. 數據重整 - 清理遷移數據並釋放空間
4. 自動清理 - 刪除無效數據
```

### ⚡ 效能問題

**Q11: 保存速度很慢？**

**A:** 正常範圍：
- 一般頁面：2-5 秒
- 超長文章（8000+ 字）：10-20 秒（自動分批）
- 大量標註：額外 2-3 秒

**優化建議：**
- 檢查網絡速度
- 減少不必要的標註
- 避免保存超大圖片

**Q12: 標註模式下頁面卡頓？**

**A:** 可能原因：
- 頁面本身複雜度高
- 標註數量過多（100+ 個）
- 瀏覽器效能限制

**解決方案：**
- 關閉標註模式（點擊「Stop Highlighting」）
- 清理不需要的標註
- 重啟瀏覽器

---

## 🔧 故障排除

### 🔍 常見錯誤排查

**錯誤：「Failed to fetch」**
- **解決**：檢查網絡連接。如果網絡正常，可能是 Notion API 暫時不可用。

**錯誤：「Invalid API Token」**
- **解決**：API Token 可能錯誤或已失效。請在 Notion 重新生成並更新設置。

**錯誤：「Database not found」**
- **解決**：資料庫可能已被刪除，或 Integration 失去了訪問權限。請在 Notion 資料庫頁面重新添加 Connection。

### 🐞 開啟調適模式 (排查問題)

如果您遇到無法解決的異常情況，可以開啟調適模式來獲取詳細日誌，這有助於定位問題。

**步驟：**

1. **進入設定**：
   - 右鍵點擊擴展圖標 → 選擇「選項」或「Options」。
   - 或者點擊擴展彈出視窗中的 `⚙️ Settings`。

2. **啟用日誌開關**：
   - 向下捲動至頁面底部的「**日誌與診斷**」區域。
   - 勾選「**啟用偵錯日誌**」選項。
   - *（此功能會將前端操作日誌轉送到背景頁面，以便統一查看）*

3. **查看日誌內容**：
   - 在 Chrome 瀏覽器網址列輸入 `chrome://extensions/` 並進入。
   - 開啟右上角的「**開發者模式**」。
   - 找到 "Notion Smart Clipper" 擴展卡片。
   - 點擊「**檢查視圖**」旁邊的 `service worker` 連結。
   - 在彈出的開發者工具視窗中，切換到 `Console` 標籤頁。
   - 該處會顯示擴展運行的詳細流程與錯誤訊息。

4. **反饋問題**：
   - 將 Console 中的紅色錯誤訊息截圖或複製，在提交 Issue 時提供。

### 📤 導出偵錯日誌

如果您需要向開發者報告複雜問題，導出系統日誌將非常有幫助。

**步驟：**
1. 進入設定頁面的「**診斷工具**」區塊。
2. 確保「**啟用除錯日誌**」已開啟（這能記錄更多細節）。
3. 點擊「**導出偵錯日誌**」按鈕。
4. 系統會生成一個 JSON 文件（包含脫敏後的日誌），請將此文件附在您的 Issue 中。

### 🔄 數據管理與修復

在設置頁面的「**數據管理**」區域，您可以：
- **備份/恢復數據**：將設置和標註數據導出為 JSON 文件備份。
- **檢查完整性**：掃描是否有損壞的標註數據。
- **數據重整**：優化存儲空間，清理已刪除頁面的殘留數據。

---

## 💡 使用技巧

**1. 批量狀態檢查**
打開多個文章頁面，快速切換標籤頁，查看擴展圖標是否有綠色 "✓"，即可知道哪些未保存。

**2. 標註分類法**
- 🟡 **黃色**：一般重點
- 🟢 **綠色**：關鍵結論/定義
- 🔴 **紅色**：疑問或待查證
- 🔵 **藍色**：參考資料/引用

**3. 快捷鍵**
在 `chrome://extensions/shortcuts` 中可以為「激活擴展」設置快捷鍵（如 `Alt+S`），實現全鍵盤操作流。

---

## 💬 反饋與支持

如果本指南沒有解決你的問題：
- 📧 訪問 GitHub Repository 提交 Issue
- 🐛 報告 Bug 時請提供：版本號、瀏覽器版本及錯誤截圖

<div align="center">
  <strong>🎉 感謝使用 Notion Smart Clipper！</strong>
</div>
