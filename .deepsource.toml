version = 1

# Patterns to mark as test files (DeepSource will apply different analysis rules)
test_patterns = [
  "tests/**",
  "**/*.test.js",
  "**/*.spec.js"
]

# Patterns to completely exclude from analysis
exclude_patterns = [
  # Original exclusions
  "**/mocks/**",
  "internal/**",
  "archive/**",
  "releases/**",
  "coverage/**",
  "node_modules/**",
  "lib/**",
  # New exclusions for Release PR noise reduction
  "dist/**",
  "CHANGELOG.md",
  "**/*.min.js",
  "**/*.bundle.js",
  "tests/e2e/run-with-coverage.js"
]

[[analyzers]]
name = "javascript"
enabled = true

  [analyzers.meta]
  environment = ["browser", "nodejs"]

  # Skip doc coverage checks for some constructs to reduce DOCUMENTATION noise
  skip_doc_coverage = ["class-expression", "method-definition"]

  # Cyclomatic complexity threshold: low, medium, high, very-high, critical
  cyclomatic_complexity_threshold = "very-high"

  # Filter out false positives for error logging patterns
  [[analyzers.issue_filter]]
  issue_code = "JS-0427"
  paths = ["scripts/**/*.js"]

  # Allow console usage in test files
  [[analyzers.issue_filter]]
  issue_code = "JS-0002"
  paths = ["tests/**/*.js"]

  # Allow console usage in Logger.js
  [[analyzers.issue_filter]]
  issue_code = "JS-0002"
  paths = ["scripts/utils/Logger.js"]

  # Ignore class-methods-use-this for factory/utility patterns
  [[analyzers.issue_filter]]
  issue_code = "JS-0105"
  paths = [
    "scripts/content/converters/ConverterFactory.js",
    "scripts/content/converters/MarkdownConverter.js",
    "scripts/content/extractors/MetadataExtractor.js"
  ]

  # Ignore callback literal in tests - Chrome APIs don't follow Node.js error-first callback convention
  [[analyzers.issue_filter]]
  issue_code = "JS-0417"
  paths = ["tests/**/*.js"]

  # Ignore init-declarations in tests - Jest requires declaring variables outside describe() and initializing in beforeEach()
  [[analyzers.issue_filter]]
  issue_code = "JS-0064"
  paths = ["tests/**/*.js"]
