
> notion-smart-clipper@2.13.1 test
> jest --config jest.config.js tests/unit/utils.test.js

FAIL tests/unit/utils.test.js
  â— utils.js â€º StorageUtil â€º clearHighlights â€º æ‡‰è©²æ¸…é™¤ chrome.storage å’Œ localStorage ä¸­çš„æ¨™è¨»

    ReferenceError: safeLogger is not defined

      288 |           const pageKey = `highlights_${normalizedUrl}`;
      289 |
    > 290 |           safeLogger.log('ğŸ—‘ï¸ [clearHighlights] é–‹å§‹æ¸…é™¤æ¨™è¨»:', pageKey);
          |           ^
      291 |
      292 |           const results = await Promise.allSettled([
      293 |             this._clearFromChromeStorage(pageKey),

      at Object.safeLogger [as clearHighlights] (scripts/utils.js:290:11)
      at Object.clearHighlights (tests/unit/utils.test.js:197:42)

  â— utils.js â€º StorageUtil â€º clearHighlights â€º æ‡‰è©²è™•ç† chrome.storage ä¸å¯ç”¨çš„æƒ…æ³

    ReferenceError: safeLogger is not defined

      288 |           const pageKey = `highlights_${normalizedUrl}`;
      289 |
    > 290 |           safeLogger.log('ğŸ—‘ï¸ [clearHighlights] é–‹å§‹æ¸…é™¤æ¨™è¨»:', pageKey);
          |           ^
      291 |
      292 |           const results = await Promise.allSettled([
      293 |             this._clearFromChromeStorage(pageKey),

      at Object.safeLogger [as clearHighlights] (scripts/utils.js:290:11)
      at Object.clearHighlights (tests/unit/utils.test.js:213:42)

  â— utils.js â€º Logger â€º æ‡‰è©²æ­£ç¢ºè¨˜éŒ„ debug ä¿¡æ¯ï¼ˆé€éèƒŒæ™¯ sinkï¼‰

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"action": "devLogSink", "args": ["arg1", "arg2"], "level": "debug", "message": "test message"}, Any<Function>

    Number of calls: 0

      229 |         test('æ‡‰è©²æ­£ç¢ºè¨˜éŒ„ debug ä¿¡æ¯ï¼ˆé€éèƒŒæ™¯ sinkï¼‰', () => {
      230 |             window.Logger.debug('test message', 'arg1', 'arg2');
    > 231 |             expect(mockChrome.runtime.sendMessage).toHaveBeenCalledWith(
          |                                                    ^
      232 |                 expect.objectContaining({
      233 |                     action: 'devLogSink',
      234 |                     level: 'debug',

      at Object.toHaveBeenCalledWith (tests/unit/utils.test.js:231:52)

  â— utils.js â€º Logger â€º æ‡‰è©²æ­£ç¢ºè¨˜éŒ„ info ä¿¡æ¯ï¼ˆé€éèƒŒæ™¯ sinkï¼‰

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"action": "devLogSink", "args": ["arg1"], "level": "info", "message": "test message"}, Any<Function>

    Number of calls: 0

      242 |         test('æ‡‰è©²æ­£ç¢ºè¨˜éŒ„ info ä¿¡æ¯ï¼ˆé€éèƒŒæ™¯ sinkï¼‰', () => {
      243 |             window.Logger.info('test message', 'arg1');
    > 244 |             expect(mockChrome.runtime.sendMessage).toHaveBeenCalledWith(
          |                                                    ^
      245 |                 expect.objectContaining({
      246 |                     action: 'devLogSink',
      247 |                     level: 'info',

      at Object.toHaveBeenCalledWith (tests/unit/utils.test.js:244:52)

  â— utils.js â€º Logger â€º æ‡‰è©²æ­£ç¢ºè¨˜éŒ„ warn ä¿¡æ¯ï¼ˆé€éèƒŒæ™¯ sinkï¼‰

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"action": "devLogSink", "level": "warn", "message": "test message"}, Any<Function>

    Number of calls: 0

      255 |         test('æ‡‰è©²æ­£ç¢ºè¨˜éŒ„ warn ä¿¡æ¯ï¼ˆé€éèƒŒæ™¯ sinkï¼‰', () => {
      256 |             window.Logger.warn('test message');
    > 257 |             expect(mockChrome.runtime.sendMessage).toHaveBeenCalledWith(
          |                                                    ^
      258 |                 expect.objectContaining({
      259 |                     action: 'devLogSink',
      260 |                     level: 'warn',

      at Object.toHaveBeenCalledWith (tests/unit/utils.test.js:257:52)

  â— utils.js â€º Logger â€º æ‡‰è©²æ­£ç¢ºè¨˜éŒ„ error ä¿¡æ¯ï¼ˆé€éèƒŒæ™¯ sinkï¼‰

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"action": "devLogSink", "args": ["error"], "level": "error", "message": "test message"}, Any<Function>

    Number of calls: 0

      267 |         test('æ‡‰è©²æ­£ç¢ºè¨˜éŒ„ error ä¿¡æ¯ï¼ˆé€éèƒŒæ™¯ sinkï¼‰', () => {
      268 |             window.Logger.error('test message', 'error');
    > 269 |             expect(mockChrome.runtime.sendMessage).toHaveBeenCalledWith(
          |                                                    ^
      270 |                 expect.objectContaining({
      271 |                     action: 'devLogSink',
      272 |                     level: 'error',

      at Object.toHaveBeenCalledWith (tests/unit/utils.test.js:269:52)

Test Suites: 1 failed, 1 total
Tests:       6 failed, 12 passed, 18 total
Snapshots:   0 total
Time:        1.298 s
Ran all test suites matching /tests\/unit\/utils.test.js/i.
