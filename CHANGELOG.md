# 變更日誌 (CHANGELOG)

## [v2.3.0] - 2025-09-22

### 🎯 重大改進

#### 核心功能修復
- ✅ **修復標記狀態保存問題**：解決頁面重新整理後標記丟失的問題
- ✅ **修復單個標記刪除功能**：恢復的標記現在支援雙擊刪除
- 🔧 **改善標記恢復機制**：優化自動恢復邏輯，提高可靠性

#### 代碼架構重構
- 🏗️ **建立統一腳本注入管理**：
  - 新增 `ScriptInjector` 類統一管理所有腳本注入
  - 標準化錯誤處理和日誌記錄
  - 簡化腳本注入邏輯，提高可維護性

- 📦 **創建共享工具模組** (`scripts/utils.js`)：
  - `normalizeUrl()` - 標準化 URL 函數
  - `StorageUtil` - 統一存儲管理類
  - `Logger` - 標準化日誌工具
  - 消除代碼重複，提升一致性

- 🔄 **現代化異步處理**：
  - 將所有回調函數重構為 `async/await` 模式
  - 消除回調地獄，提高代碼可讀性
  - 改善錯誤處理流程

### 📁 文件變更

#### 新增文件
- `scripts/utils.js` - 共享工具函數模組

#### 重大重構
- `scripts/background.js` - 主背景腳本完全重構
  - 整合 ScriptInjector 類
  - 重構所有消息處理器
  - 現代化異步處理模式
  
- `scripts/highlighter.js` - 標記工具重構
  - 使用共享 utils.js 模組
  - 新增 setupExistingHighlights() 方法
  - 改善事件處理邏輯
  
- `scripts/highlight-restore.js` - 標記恢復腳本重寫
  - 使用共享存儲工具
  - 優化恢復邏輯
  - 自動設置事件監聽器

### 🐛 問題修復
- 修復頁面重新整理後標記狀態丟失
- 修復恢復的標記無法刪除的問題
- 修復深層嵌套回調導致的錯誤處理問題
- 改善腳本注入的錯誤處理

### 🚀 效能提升
- 減少重複的 DOM 查詢
- 優化腳本注入時機
- 改善存儲操作效率
- 統一化錯誤處理減少冗餘代碼

### 🔧 開發體驗改善
- 標準化代碼風格
- 改善模組化架構
- 增強錯誤日誌
- 提高代碼可維護性

### 📝 技術債務清理
- 消除多處代碼重複
- 移除過時的錯誤處理邏輯
- 統一命名規範
- 改善註釋和文檔

---

## [v2.2.x] - 之前版本
請參考 RELEASE_NOTES_v2.2.md

## [v2.1.x] - 之前版本  
請參考 RELEASE_NOTES_v2.1.md