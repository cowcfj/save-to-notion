# E2E æ¸¬è©¦è¦†è“‹ç‡æ•´åˆ - å¯¦æ–½ç¸½çµ (Playwright)

## ğŸ“‹ å®Œæˆç‹€æ…‹

âœ… **å·²å®Œæˆ** - å·²æˆåŠŸå¾ Puppeteer é·ç§»è‡³ Playwrightï¼Œä¸¦å¯¦ç¾äº†å®Œæ•´çš„è¦†è“‹ç‡æ”¶é›†èˆ‡åˆä½µæµç¨‹ã€‚

## ğŸ¯ å¯¦æ–½å…§å®¹

### 1. æ ¸å¿ƒçµ„ä»¶ï¼ˆPlaywright æ¶æ§‹ï¼‰

| ç¾ä»¶                                | èªªæ˜                                        | ç‹€æ…‹ |
| ----------------------------------- | ------------------------------------------- | ---- |
| `playwright.config.js`              | Playwright ä¸»é…ç½®æ–‡ä»¶                       | âœ…   |
| `tests/e2e/fixtures.js`             | æ ¸å¿ƒ Fixtures (Extension åŠ è¼‰, V8 Coverage) | âœ…   |
| `tests/e2e/specs/highlight.spec.js` | é«˜äº®åŠŸèƒ½æ¸¬è©¦ç”¨ä¾‹                            | âœ…   |
| `tests/e2e/coverage-merger.js`      | çµ±ä¸€è¦†è“‹ç‡åˆä½µå·¥å…· (Jest + Playwright)      | âœ…   |
| `tests/e2e/scenarios/`              | _èˆŠ Puppeteer å ´æ™¯ (å·²æ­¸æª”/é·ç§»)_           | ğŸ”„   |

### 2. æ–‡æª”ï¼ˆå·²æ›´æ–°ï¼‰

| æ–‡ä»¶                | èªªæ˜                | ç‹€æ…‹ |
| ------------------- | ------------------- | ---- |
| `COVERAGE-GUIDE.md` | å®Œæ•´æ¶æ§‹èˆ‡æ•´åˆæŒ‡å—  | âœ…   |
| `README.md`         | Playwright å¿«é€Ÿé–‹å§‹ | âœ…   |
| `MCP-TESTING.md`    | MCP äº¤äº’å¼æ¸¬è©¦æŒ‡å—  | âœ…   |

### 3. CI/CD æ•´åˆï¼ˆå·²å®Œæˆï¼‰

| æ–‡ä»¶                       | ä¿®æ”¹å…§å®¹                       | ç‹€æ…‹ |
| -------------------------- | ------------------------------ | ---- |
| `.github/workflows/ci.yml` | é›†æˆ Playwright æ¸¬è©¦èˆ‡å ±å‘Šä¸Šå‚³ | âœ…   |

### è¦†è“‹ç‡æå‡ç­–ç•¥

é€šéå¼•å…¥ Playwright E2E æ¸¬è©¦ï¼Œæˆ‘å€‘å¯¦ç¾äº†å°çœŸå¯¦ç€è¦½å™¨ç’°å¢ƒä¸‹æ“´å……åŠŸèƒ½è¡Œç‚ºçš„è¦†è“‹ï¼š

| æ¨¡å¡Š                  | è¦†è“‹æ–¹å¼                       | é æœŸæ”¶ç›Š                                     |
| --------------------- | ------------------------------ | -------------------------------------------- |
| **background.js**     | Mock Service Worker `evaluate` | æ¸¬è©¦ Message Passing, Storage, Context Menus |
| **content.js**        | çœŸå¯¦é é¢æ³¨å…¥èˆ‡åŸ·è¡Œ             | æ¸¬è©¦ DOM æ“ä½œ, å…§å®¹æå–                      |
| **highlighter-v2.js** | çœŸå¯¦ç”¨æˆ¶äº¤äº’ (Click, Select)   | æ¸¬è©¦ CSS Highlights API, UI äº¤äº’             |

## ğŸ”§ æŠ€è¡“å †ç–Šå°æ¯”

| ç‰¹æ€§             | èˆŠæ–¹æ¡ˆ (Puppeteer)     | æ–°æ–¹æ¡ˆ (Playwright)   | å„ªå‹¢                          |
| ---------------- | ---------------------- | --------------------- | ----------------------------- |
| **åŸ·è¡Œå¼•æ“**     | Puppeteer              | Playwright            | æ›´å¿«ã€æ›´ç©©å®šçš„ WebSocket é€£æ¥ |
| **æ“´å……åŠŸèƒ½æ”¯æŒ** | åŸºç¤                   | åŸç”Ÿ (Headless = new) | æ”¯æŒ Service Worker æ¸¬è©¦      |
| **ç­‰å¾…æ©Ÿåˆ¶**     | æ‰‹å‹• waitFor           | è‡ªå‹• Auto-wait        | æ¸›å°‘ Flaky tests              |
| **èª¿è©¦å·¥å…·**     | Console logs           | Trace Viewer, UI Mode | æ¥µå¤§æå‡ DX                   |
| **è¦†è“‹ç‡æ”¶é›†**   | Puppeteer Coverage API | V8 Coverage (via CDP) | æ›´ç²¾ç¢ºçš„ Block ç´šè¦†è“‹         |

## ğŸš€ å¾ŒçºŒè¨ˆåŠƒ

1.  **é·ç§»æ›´å¤šå ´æ™¯**: å°‡ `scenarios/content-extraction.e2e.js` ç­‰èˆŠå ´æ™¯å®Œå…¨é·ç§»ç‚º `.spec.js`.
2.  **å®Œå–„ Save åŠŸèƒ½æ¸¬è©¦**: `save.spec.js` (é€²è¡Œä¸­).
3.  **UI å›æ­¸æ¸¬è©¦**: åˆ©ç”¨ Playwright çš„ Screenshot diff åŠŸèƒ½é€²è¡Œè¦–è¦ºæ¸¬è©¦.

## ğŸ‰ ç¸½çµ

Playwright çš„å¼•å…¥æ¨™èªŒè‘— E2E æ¸¬è©¦é€²å…¥äº†ç¾ä»£åŒ–éšæ®µã€‚ä¸åƒ…è§£æ±ºäº† Puppeteer åœ¨æ¸¬è©¦ Chrome Extension æ™‚çš„è«¸å¤šç—›é»ï¼ˆå¦‚ Service Worker è¨ªå•å›°é›£ï¼‰ï¼Œé‚„æä¾›äº†å¼·å¤§çš„èª¿è©¦èƒ½åŠ›å’Œç©©å®šçš„åŸ·è¡Œç’°å¢ƒã€‚

**ç¾åœ¨ï¼Œé‹è¡Œ `npm run test:all` å³å¯äº«å—å…¨æ£§æ¸¬è©¦çš„ä¿è­·ï¼**
