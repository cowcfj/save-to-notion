# E2E è¦†è“‹ç‡æ•´åˆ - å¿«é€Ÿé–‹å§‹

## ğŸš€ 5 åˆ†é˜å¿«é€Ÿé–‹å§‹

### 1. å®‰è£ä¾è³´

```bash
npm install
```

æ–°å¢çš„ä¾è³´ï¼š

- `puppeteer` - ç€è¦½å™¨è‡ªå‹•åŒ–
- `istanbul-lib-coverage` - è¦†è“‹ç‡æ•¸æ“šè™•ç†
- `istanbul-lib-report` - è¦†è“‹ç‡å ±å‘Šç”Ÿæˆ
- `istanbul-reports` - è¦†è“‹ç‡å ±å‘Šæ ¼å¼

### 2. æ§‹å»ºæ“´å±•

```bash
npm run build
```

ç¢ºä¿ `dist/` ç›®éŒ„å·²ç”Ÿæˆã€‚

### 3. é‹è¡Œæ¸¬è©¦

```bash
# æ–¹å¼ A: é‹è¡Œæ‰€æœ‰æ¸¬è©¦ï¼ˆæ¨è–¦ï¼‰
npm run test:all

# æ–¹å¼ B: åªé‹è¡Œ E2E æ¸¬è©¦
npm run test:e2e

# æ–¹å¼ C: åˆ†æ­¥åŸ·è¡Œ
npm run test:coverage    # å…ˆé‹è¡Œ Jest å–®å…ƒæ¸¬è©¦
npm run test:e2e:only    # å†é‹è¡Œ E2E æ¸¬è©¦
npm run test:merge-coverage  # æœ€å¾Œåˆä½µè¦†è“‹ç‡
```

### 4. æŸ¥çœ‹å ±å‘Š

```bash
# macOS
open coverage/merged/index.html

# æˆ–åœ¨çµ‚ç«¯ç›´æ¥æŸ¥çœ‹
cat coverage/merged/lcov-report/index.html
```

## ğŸ“Š é æœŸè¼¸å‡º

### çµ‚ç«¯è¼¸å‡ºç¤ºä¾‹

```
ğŸš€ E2E æ¸¬è©¦è¦†è“‹ç‡æ”¶é›†å™¨
============================================================

ğŸ“ æ­¥é©Ÿ 1/2: åŸ·è¡Œ E2E æ¸¬è©¦...

ğŸš€ å•Ÿå‹• Puppeteer ç€è¦½å™¨...
âœ… ç€è¦½å™¨å•Ÿå‹•æˆåŠŸ
ğŸ“Š é–‹å§‹ JavaScript è¦†è“‹ç‡æ”¶é›†...

ğŸ§ª åŸ·è¡Œæ¸¬è©¦å ´æ™¯: Highlighter Workflow
  ğŸ“ é–‹å§‹é«˜äº®åŠŸèƒ½æ¸¬è©¦...
  1ï¸âƒ£ å°èˆªåˆ° MDN JavaScript Guide...
  2ï¸âƒ£ ç­‰å¾…æ–‡ç« å…§å®¹åŠ è¼‰...
  3ï¸âƒ£ é©—è­‰é é¢çµæ§‹...
     âœ… æ‰¾åˆ° 32 å€‹æ®µè½
  4ï¸âƒ£ æ¸¬è©¦æ–‡æœ¬é¸æ“‡...
     âœ… æˆåŠŸé¸æ“‡æ–‡æœ¬: "The JavaScript Guide shows..."
  5ï¸âƒ£ æª¢æ¸¬ CSS Highlight API æ”¯æŒ...
     âœ… window.Highlight API
     âœ… CSS.highlights registry
  6ï¸âƒ£ æ¸¬è©¦å‰µå»º CSS Highlight...
     âœ… æˆåŠŸå‰µå»ºé«˜äº®ï¼Œç•¶å‰å…±æœ‰ 1 å€‹é«˜äº®
  7ï¸âƒ£ æ¸¬è©¦é«˜äº®æ•¸æ“šæŒä¹…åŒ–...
     âœ… æˆåŠŸä¿å­˜ 1 å€‹é«˜äº®åˆ° localStorage
  8ï¸âƒ£ æ¸¬è©¦é é¢åˆ·æ–°å¾Œæ¢å¾©...
     âœ… æˆåŠŸæ¢å¾© 1 å€‹é«˜äº®
  âœ… é«˜äº®åŠŸèƒ½æ¸¬è©¦å®Œæˆï¼

âœ… Highlighter Workflow - æ¸¬è©¦é€šé

ğŸ›‘ åœæ­¢è¦†è“‹ç‡æ”¶é›†...
âœ… æ”¶é›†åˆ° 15 å€‹ JavaScript æ–‡ä»¶çš„è¦†è“‹ç‡æ•¸æ“š

ğŸ”„ è½‰æ›è¦†è“‹ç‡æ ¼å¼ç‚º Istanbul...
âœ… è½‰æ›å®Œæˆï¼ŒåŒ…å« 8 å€‹æ–‡ä»¶

ğŸ’¾ ä¿å­˜è¦†è“‹ç‡å ±å‘Šåˆ°: coverage/e2e
  âœ… text å ±å‘Šå·²ç”Ÿæˆ
  âœ… json å ±å‘Šå·²ç”Ÿæˆ
  âœ… lcov å ±å‘Šå·²ç”Ÿæˆ
  âœ… html å ±å‘Šå·²ç”Ÿæˆ
âœ… æ‰€æœ‰è¦†è“‹ç‡å ±å‘Šå·²ç”Ÿæˆ

============================================================
ğŸ“Š E2E æ¸¬è©¦çµæœæ‘˜è¦
============================================================
âœ… Highlighter Workflow
âœ… Content Extraction

ç¸½è¨ˆ: 2/2 é€šé
============================================================

ğŸ“ æ­¥é©Ÿ 2/2: åˆä½µè¦†è“‹ç‡å ±å‘Š...

ğŸ“– åŠ è¼‰ Jest å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡...
âœ… å·²åŠ è¼‰ 42 å€‹æ–‡ä»¶çš„ Jest è¦†è“‹ç‡
ğŸ“– åŠ è¼‰ E2E æ¸¬è©¦è¦†è“‹ç‡...
âœ… å·²åŠ è¼‰ 8 å€‹æ–‡ä»¶çš„ E2E è¦†è“‹ç‡

ğŸ“Š ç”Ÿæˆåˆä½µå¾Œçš„è¦†è“‹ç‡å ±å‘Š...
  âœ… text å ±å‘Šå·²ç”Ÿæˆ
  âœ… json å ±å‘Šå·²ç”Ÿæˆ
  âœ… lcov å ±å‘Šå·²ç”Ÿæˆ
  âœ… html å ±å‘Šå·²ç”Ÿæˆ

âœ… æ‰€æœ‰å ±å‘Šå·²ä¿å­˜åˆ°: coverage/merged

============================================================
ğŸ“Š åˆä½µå¾Œçš„è¦†è“‹ç‡æ‘˜è¦
============================================================

èªå¥è¦†è“‹ç‡:   52.34% (1234/2356)
åˆ†æ”¯è¦†è“‹ç‡:   38.21% (456/1193)
å‡½æ•¸è¦†è“‹ç‡:   45.67% (234/512)
è¡Œè¦†è“‹ç‡:     51.89% (1198/2310)

============================================================

============================================================
ğŸ“ˆ è¦†è“‹ç‡è®ŠåŒ–
============================================================
statements  : 46.56% â†’ 52.34% â†—ï¸ +5.78%
branches    : 33.12% â†’ 38.21% â†—ï¸ +5.09%
functions   : 40.23% â†’ 45.67% â†—ï¸ +5.44%
lines       : 46.01% â†’ 51.89% â†—ï¸ +5.88%
============================================================

============================================================
ğŸ‰ æ¸¬è©¦è¦†è“‹ç‡æ”¶é›†å®Œæˆï¼
============================================================

ğŸ“Š å ±å‘Šä½ç½®:
   - E2E è¦†è“‹ç‡:    coverage/e2e
   - åˆä½µè¦†è“‹ç‡:    coverage/merged

ğŸ“ˆ è¦†è“‹ç‡æå‡:
   - èªå¥: 46.56% â†’ 52.34%
   - åˆ†æ”¯: 33.12% â†’ 38.21%
   - å‡½æ•¸: 40.23% â†’ 45.67%
   - è¡Œæ•¸: 46.01% â†’ 51.89%

ğŸ’¡ æŸ¥çœ‹è©³ç´°å ±å‘Š: open coverage/merged/index.html

============================================================
```

## ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶çµæ§‹

```
coverage/
â”œâ”€â”€ coverage-final.json         # Jest è¦†è“‹ç‡ï¼ˆJSONï¼‰
â”œâ”€â”€ lcov.info                   # Jest è¦†è“‹ç‡ï¼ˆLCOVï¼‰
â”œâ”€â”€ lcov-report/                # Jest è¦†è“‹ç‡ï¼ˆHTMLï¼‰
â”‚   â””â”€â”€ index.html
â”‚
â”œâ”€â”€ e2e/
â”‚   â”œâ”€â”€ coverage-final.json     # E2E è¦†è“‹ç‡ï¼ˆJSONï¼‰
â”‚   â”œâ”€â”€ lcov.info               # E2E è¦†è“‹ç‡ï¼ˆLCOVï¼‰
â”‚   â””â”€â”€ lcov-report/            # E2E è¦†è“‹ç‡ï¼ˆHTMLï¼‰
â”‚       â””â”€â”€ index.html
â”‚
â””â”€â”€ merged/
    â”œâ”€â”€ coverage-final.json     # åˆä½µè¦†è“‹ç‡ï¼ˆJSONï¼‰âœ¨
    â”œâ”€â”€ lcov.info               # åˆä½µè¦†è“‹ç‡ï¼ˆLCOVï¼‰âœ¨
    â””â”€â”€ lcov-report/            # åˆä½µè¦†è“‹ç‡ï¼ˆHTMLï¼‰âœ¨
        â””â”€â”€ index.html          # ğŸ‘ˆ æ‰“é–‹é€™å€‹æŸ¥çœ‹å®Œæ•´å ±å‘Š
```

## ğŸ¯ npm è…³æœ¬èªªæ˜

| å‘½ä»¤                          | èªªæ˜                         |
| ----------------------------- | ---------------------------- |
| `npm test`                    | é‹è¡Œ Jest å–®å…ƒæ¸¬è©¦           |
| `npm run test:coverage`       | é‹è¡Œ Jest å–®å…ƒæ¸¬è©¦ + è¦†è“‹ç‡  |
| `npm run test:e2e`            | é‹è¡Œ E2E æ¸¬è©¦ + åˆä½µè¦†è“‹ç‡   |
| `npm run test:e2e:only`       | åªé‹è¡Œ E2E æ¸¬è©¦ï¼ˆä¸åˆä½µï¼‰    |
| `npm run test:merge-coverage` | æ‰‹å‹•åˆä½µè¦†è“‹ç‡               |
| `npm run test:all`            | é‹è¡Œæ‰€æœ‰æ¸¬è©¦ + åˆä½µè¦†è“‹ç‡ â­ |

## ğŸ”§ é…ç½®æ–‡ä»¶

- `tests/e2e/coverage-config.js` - ä¸»é…ç½®æ–‡ä»¶
- `tests/e2e/scenarios/*.e2e.js` - æ¸¬è©¦å ´æ™¯
- `jest.config.js` - Jest é…ç½®ï¼ˆä¸éœ€è¦ä¿®æ”¹ï¼‰

## ğŸ“ å‰µå»ºæ–°çš„æ¸¬è©¦å ´æ™¯

1. åœ¨ `tests/e2e/scenarios/` å‰µå»ºæ–°æ–‡ä»¶ï¼š

```javascript
// tests/e2e/scenarios/my-test.e2e.js
module.exports = {
  name: 'My Test',

  async run(page, config) {
    // æ¸¬è©¦é‚è¼¯
    await page.goto('https://example.com');
    const result = await page.evaluate(() => {
      return { title: document.title };
    });
    return result;
  },
};
```

2. åœ¨ `coverage-config.js` ä¸­å•Ÿç”¨ï¼š

```javascript
testScenarios: [
  // ... ç¾æœ‰å ´æ™¯
  {
    name: 'My Test',
    file: 'tests/e2e/scenarios/my-test.e2e.js',
    enabled: true,
  },
];
```

3. é‹è¡Œæ¸¬è©¦ï¼š

```bash
npm run test:e2e
```

## â“ å¸¸è¦‹å•é¡Œ

### Q1: ç‚ºä»€éº¼è¦†è“‹ç‡æ²’æœ‰æå‡ï¼Ÿ

A: æª¢æŸ¥ä»¥ä¸‹å¹¾é»ï¼š

1. æ˜¯å¦é‹è¡Œäº† `npm run build` æ§‹å»ºæ“´å±•ï¼Ÿ
2. E2E æ¸¬è©¦æ˜¯å¦å¯¦éš›åŸ·è¡Œäº†ç›®æ¨™ä»£ç¢¼ï¼Ÿ
3. æŸ¥çœ‹ `coverage/e2e/` æ˜¯å¦æœ‰è¦†è“‹ç‡æ•¸æ“šï¼Ÿ

### Q2: Puppeteer ä¸‹è¼‰å¤±æ•—æ€éº¼è¾¦ï¼Ÿ

A: ä½¿ç”¨ç’°å¢ƒè®Šé‡è·³éä¸‹è¼‰ï¼š

```bash
PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true npm install
```

ç„¶å¾Œåœ¨é…ç½®ä¸­æŒ‡å®šç³»çµ± Chromeï¼š

```javascript
puppeteer: {
  executablePath: '/usr/bin/google-chrome';
}
```

### Q3: æ¸¬è©¦é‹è¡Œå¾ˆæ…¢æ€éº¼è¾¦ï¼Ÿ

A: æ¸›å°‘æ¸¬è©¦å ´æ™¯æ•¸é‡ï¼š

```javascript
testScenarios: [
  { name: 'Highlighter', enabled: true },
  { name: 'Content Extraction', enabled: false }, // æš«æ™‚ç¦ç”¨
];
```

### Q4: å¦‚ä½•åœ¨ CI ä¸­é‹è¡Œï¼Ÿ

A: åœ¨ GitHub Actions ä¸­æ·»åŠ ï¼š

```yaml
- name: Run tests with coverage
  run: npm run test:all

- name: Upload coverage
  uses: codecov/codecov-action@v3
  with:
    files: ./coverage/merged/lcov.info
```

## ğŸ“ ä¸‹ä¸€æ­¥

- ğŸ“– é–±è®€å®Œæ•´æ–‡æª”: `E2E-COVERAGE-GUIDE.md`
- ğŸ§ª æŸ¥çœ‹æ¸¬è©¦å ´æ™¯: `scenarios/highlighter.e2e.js`
- ğŸ› ï¸ è‡ªå®šç¾©é…ç½®: `coverage-config.js`
- ğŸ“Š æŸ¥çœ‹ HTML å ±å‘Š: `open coverage/merged/index.html`

## ğŸ’¡ æŠ€è¡“åŸç†

```
Jest æ¸¬è©¦ (JSDOM)
    â†“
Istanbul æ’æ¡©
    â†“
è¦†è“‹ç‡æ•¸æ“š (coverage-final.json)

E2E æ¸¬è©¦ (Puppeteer)
    â†“
Puppeteer Coverage API
    â†“
è½‰æ›ç‚º Istanbul æ ¼å¼
    â†“
è¦†è“‹ç‡æ•¸æ“š (e2e/coverage-final.json)

å…©è€…åˆä½µ
    â†“
çµ±ä¸€å ±å‘Š (merged/)
```

## ğŸ‰ é–‹å§‹æ¸¬è©¦ï¼

```bash
npm run test:all
```

ç¥ä½ æ¸¬è©¦é †åˆ©ï¼ ğŸš€
