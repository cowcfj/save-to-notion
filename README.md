# Notion Smart Clipper v2.5.7

一個智能的 Chrome 擴展，用於將網頁內容保存到 Notion，**v2.5.7 最新版本**：修復作者頭像/Logo 誤識別為封面圖，支持封面圖提取、增強的圖片提取、原生 CSS Highlight API 標註系統和多顏色標註！

## ✨ 主要功能

### 🆕 新一代標註系統 (v2.5.x)
- **CS## 📝 更新日誌

### v2.5.7 (最新版本)
- 🎯 **修復作者頭像/Logo 誤識別**：智能過濾作者頭像，避免被誤識別為封面圖
  - 多維度檢測：關鍵詞、尺寸、形狀
  - 適用於 Medium、WordPress、新聞網站等所有平台
- ✅ **更準確的封面圖識別**：真正的文章封面圖正確提取

### v2.5.6
- 🖼️ **封面圖優先提取**：自動識別文章封面圖/Hero 圖片
  - 20 個封面圖選擇器，涵蓋 WordPress、CMS 和自定義容器
  - 封面圖作為第一張圖片顯示在 Notion 頁面頂部
- 🐛 **關鍵修復**：修復封面圖提取邏輯未生效、StorageUtil 重複聲明錯誤

### v2.5.5
- 🎯 **優化圖片收集策略**：避免收集無關圖片
  - 更嚴格的觸發條件
  - 排除非內容區域（header, footer, nav, ads）
  
### v2.5.4
- 🖼️ **擴展圖片提取能力**：支持更多圖片屬性和格式
  - +21 個圖片屬性支持
  - +18 個路徑模式，+13 種格式

### v2.5.3
- 🎨 **多顏色標註選擇器**：4 種顏色快速切換
- 🖱️ **視覺選擇反饋**：選中顏色放大顯示
- ⚡ **即時顏色切換**：點擊即可切換當前標註顏色

### v2.5.0
- 🎯 **CSS Highlight API**：全新標註系統，零 DOM 修改
- 🔄 **無痛自動遷移**：三階段智能遷移，自動回滾
- ✨ **完美跨元素支持**：解決跨段落、跨標籤標註問題

### v2.4.x
- 🖼️ **增強圖片支持**：懶加載、響應式圖片、URL 清理
- 🔧 **URL 正規化**：移除追蹤參數和 fragment
- 🎨 **模板自定義**：靈活的標題和內容模板

完整更新記錄請查看 [CHANGELOG.md](CHANGELOG.md)PI**：使用瀏覽器原生標註功能
- **零 DOM 修改**：不改變網頁結構，完美兼容各種網站
- **完美跨元素支持**：任意複雜的文本選擇都能正常標註
- **多顏色標註** (v2.5.3)：支持 4 種顏色（黃、綠、藍、紅）標註選擇
- **無痛自動遷移**：自動將舊標註升級到新系統，完全透明
- **智能回滾機制**：遷移失敗自動恢復，確保數據安全

### 📄 智能內容提取
- 使用 Readability.js 智能提取文章主要內容
- 支持多種 CMS 系統（WordPress、Drupal 等）
- 自動過濾廣告和無關內容

### 🖼️ 增強圖片支持 (v2.4.2+)
- **封面圖優先提取** (v2.5.6+)：自動識別文章封面圖/Hero 圖片
  - 20 個封面圖選擇器，涵蓋 WordPress、CMS 和自定義容器
  - 封面圖作為第一張圖片顯示在 Notion 頁面頂部
  - **智能頭像過濾** (v2.5.7)：自動排除作者頭像/logo，避免誤識別
    - 多維度檢測：關鍵詞、尺寸、形狀
    - 適用於 Medium、WordPress、新聞網站等所有平台
- 支持懶加載圖片（data-src、data-lazy-src 等）
- 支持響應式圖片（srcset）
- **智能URL清理**：自動處理代理圖片URL和重複參數
- **圖片驗證**：自動過濾無效圖片鏈接，解決「Invalid image url」錯誤
- 自動收集頁面相關圖片

### 🎨 文本標記系統
- **多顏色選擇器** (v2.5.3)：快速切換 4 種標註顏色
  - 🟡 黃色 - 一般重點標註
  - 🟢 綠色 - 正面內容、重要定義
  - 🔵 藍色 - 參考資料、補充說明
  - 🔴 紅色 - 警告、關鍵問題
- **完美跨元素選擇**：支持跨越任意HTML元素的文本標記
  - 跨段落標註
  - 跨列表項標註
  - 跨引用塊標註
  - 跨表格單元格標註
  - 跨任意複雜結構標註
- **不修改網頁**：標註不改變原始網頁結構
- **實時同步**：標記變更即時同步到 Notion 頁面
- **持久化存儲**：標記狀態自動保存和恢復

### 🖱️ 雙重標記刪除系統
- **雙擊刪除**：傳統方式，雙擊標記後確認刪除，安全可靠
- **Ctrl/Cmd + 點擊**：快速刪除，按住修飾鍵點擊即可快速刪除
- **文本選擇保護**：普通點擊和文本選擇完全不受影響

### 🔧 使用技巧
#### 標記功能（v2.5.3 更強大！）
1. **選擇顏色**：選擇文本後，點擊工具欄中的顏色按鈕選擇標註顏色
2. **直接標註**：選中文本自動創建標註，無需右鍵
3. **跨元素選擇**：可以直接選擇跨越多個段落、列表項的文本
4. **無需擔心網頁結構**：新版標註不修改網頁，完全穩定

#### 標記刪除
- **日常使用**：雙擊標記文本，確認後刪除
- **快速操作**：按住 Ctrl (Windows) 或 Cmd (Mac) + 點擊標記，立即刪除

### 🎨 模板自定義
- **標題模板**：支持變量替換
  - `{title}` - 原始標題
  - `{date}` - 當前日期 (YYYY-MM-DD)
  - `{time}` - 當前時間 (HH:MM)
  - `{datetime}` - 完整日期時間
  - `{url}` - 頁面 URL
  - `{domain}` - 網站域名
- **時間戳**：可選在內容開頭添加保存時間
- **來源信息**：可選在內容末尾添加來源鏈接

### ⚙️ 便捷設置
- 一鍵跳轉到 Notion Integration 設置
- 自動載入可用數據庫列表
- API Key 連接測試
- 模板效果預覽

## 🚀 安裝和設置

### 1. 安裝擴展
1. 下載或克隆此項目
2. 打開 Chrome 擴展管理頁面 (`chrome://extensions/`)
3. 開啟「開發者模式」
4. 點擊「載入未封裝項目」，選擇項目文件夾

### 2. 設置 Notion Integration
1. 點擊擴展圖標，選擇「Settings」
2. 點擊「連接到 Notion」按鈕
3. 在打開的 Notion 頁面中：
   - 點擊「+ New integration」
   - 填寫名稱（如：Smart Clipper）
   - 選擇工作區
   - 點擊「Submit」
4. 複製「Internal Integration Token」
5. 回到擴展設置頁面，貼上 API Key
6. 系統會自動載入可用數據庫列表
7. 選擇目標數據庫並保存設置

### 3. 配置數據庫權限
在 Notion 中：
1. 打開目標數據庫
2. 點擊右上角「...」菜單
3. 選擇「Add connections」
4. 選擇你創建的 Integration

## 📖 使用方法

### 基本使用
1. 瀏覽到想要保存的網頁
2. 點擊擴展圖標
3. 點擊「Save Page」
4. 等待保存完成

### 標記功能
1. 保存頁面後，點擊「Start Highlighting」
2. 選擇標記顏色（黃、綠、藍、紅）
3. 選中文字進行標記
4. 點擊「同步」將標記保存到 Notion
5. 雙擊標記可刪除單個標記
6. 使用「Clear Highlights」可清除所有標記

### 模板設置
1. 在設置頁面的「頁面模板設置」區域
2. 配置標題模板，例如：
   - `{title}` - 保持原標題
   - `[{domain}] {title}` - 添加網站名
   - `{title} - {date}` - 添加日期
3. 選擇是否添加時間戳和來源信息
4. 點擊「預覽效果」查看結果
5. 保存設置

## 🛠️ 技術特性

- **Manifest V3**：使用最新的 Chrome 擴展標準
- **智能內容識別**：多層回退機制確保內容提取成功
- **圖片處理優化**：支持現代網站的各種圖片載入技術
- **模板系統**：靈活的內容自定義功能
- **錯誤處理**：完善的錯誤處理和用戶反饋

## 📁 項目結構

```
notion-chrome/
├── manifest.json          # 擴展配置文件
├── popup/                 # 彈出窗口
│   ├── popup.html
│   ├── popup.js
│   └── popup.css
├── options/               # 設置頁面
│   ├── options.html
│   ├── options.js
│   └── options.css
├── scripts/               # 核心腳本
│   ├── background.js      # 後台腳本
│   ├── content.js         # 內容腳本
│   ├── highlighter-v2.js  # 新一代標註引擎
│   ├── seamless-migration.js  # 無痛遷移管理
│   └── utils.js           # 工具函數
├── lib/                   # 第三方庫
│   └── Readability.js     # Mozilla Readability
├── icons/                 # 圖標文件
└── help.html             # 幫助文檔
```

## 🔧 開發說明

### 主要組件
- **background.js**：處理擴展邏輯、API 調用、模板處理
- **content.js**：網頁內容提取、圖片處理
- **highlighter-v2.js**：基於 CSS Highlight API 的標註引擎
- **seamless-migration.js**：舊標註自動遷移管理
- **utils.js**：共享工具函數和 URL 處理
- **options.js**：設置頁面邏輯、數據庫載入

### 核心技術特點
- **CSS Highlight API**：使用瀏覽器原生 API，零 DOM 修改
- **URL 正規化**：移除追蹤參數（`utm_*`、`gclid`、`fbclid` 等）
- **智能遷移**：自動從舊版本升級，支持回滾機制
- **Range API**：精確的文本位置記錄和恢復
- **多顏色支持**：4 種標註顏色，適應不同使用場景

### 模板處理流程
1. 用戶點擊保存 → background.js 接收請求
2. 注入 content.js 提取網頁內容
3. 獲取用戶模板設置
4. 在 content script 環境中應用模板
5. 調用 Notion API 保存處理後的內容

## 📝 更新日誌

### v2.5.3 (最新版本)
- 🎨 **多顏色標註選擇器**：4 種顏色快速切換
- 🖱️ **視覺選擇反饋**：選中顏色放大顯示
- ⚡ **即時顏色切換**：點擊即可切換當前標註顏色
- � **顏色使用建議**：每種顏色的推薦使用場景

### v2.5.0
- � **CSS Highlight API**：全新標註系統，零 DOM 修改
- 🔄 **無痛自動遷移**：三階段智能遷移，自動回滾
- ✨ **完美跨元素支持**：解決跨段落、跨標籤標註問題
- �️ **智能回滾機制**：遷移失敗自動恢復，確保數據安全

### v2.4.x
- 🖼️ **增強圖片支持**：懶加載、響應式圖片、URL 清理
- 🔧 **URL 正規化**：移除追蹤參數和 fragment
- 🎨 **模板自定義**：靈活的標題和內容模板

完整更新記錄請查看 [CHANGELOG.md](CHANGELOG.md)

## 🤝 貢獻

歡迎提交 Issue 和 Pull Request 來改進這個項目！

## 🔒 隱私政策

請查看我們的 [隱私政策](PRIVACY.md) 了解更多資訊。

## 📄 許可證

MIT License
